---
title: "Case Study: Modelling approaches for meta-analyses with dependent effect sizes in ecology and evolution"
author: "Coralie Williams"
date: "Last compiled on `r format(Sys.time(), '%d %B, %Y')`"
format:
  html:
    page-layout: full
    toc: true
    toc-location: left
    toc-depth: 2
    theme: materia
    embed-resources: true
    code-fold: true
    code-tools: true
    number-sections: false
editor_options: 
  chunk_output_type: console
---

This page provide features case studies to demonstrate different modelling approaches for meta-analyses with dependent effect sizes in ecology and evolution. 


```{r}
#| echo: false
rm(list = ls())

library(pacman)
p_load(readxl, tidyverse, metafor, ape, ggplot2, ggpubr, dplyr, broom,
       knitr, kableExtra, here, cowplot, ggdist, gridExtra, clubSandwich)
```



# Crop pollinators

Bishop J, Nakagawa S. Quantifyingcrop pollinator dependence and its heterogeneity usingmulti-level meta-analysis. J Appl Ecol. 2021;58:1030â€“1042.https://doi.org/10.1111/1365-2664.13830help

```{r}
#| echo: false

# link to obtain data file
## "https://osf.io/download/dt2mf/"

# load data
data1 <- as.data.frame(read.csv("data/case_studies/vf_metaanalysis_data_main.csv",
                                skip = 1, na.strings= c("","NA")))

# calculate effect sizes (ignore error message about NaNs)
data1 <- escalc(measure="ROM", 
                m1i=meanexc, sd1i=sdexc, n1i=nexc_cont,
                m2i=meanpoll, sd2i=sdpoll, n2i=npoll,
                data=data1)

```


Fit models

```{r}
# 0.5 correlation 
data1 <- data1[order(data1$multiple_endpoint_clusterID), ] 
V.d1.endpoints_0.5 <- 

V.d1.endpoints_0.5 <- make_VCV_matrix(data = data1, V = "vi",
                                      cluster = "multiple_endpoint_clusterID",
                                      obs = "infoid",
                                      type = "vcv",
                                      rho = 0.5) 
is.positive.definite(V.d1.endpoints_0.5) #TRUE

# as noted above, we re-order data1 by the cluster ID before running models using the vcov matrix 
data1 <- data1[order(data1$multiple_endpoint_clusterID), ] 

# first null model includes only the studyid and infoid as # random effects 
RE <- rma.mv(yi = yi, V = V.d1.endpoints_0.5, random = list(~1 |
```








# Artificial light at night impact on wild vertebrates

Yang, Y., Liu, Q., Pan, C.,Chen, J., Xu, B., Liu, K. et al. (2024) Species sensitivities to artificial light at night: Aphylogenetically controlled multilevel meta-analysis on melatonin suppression. EcologyLetters, 27, e14387. Available from: https://doi.org/10.1111/ele.14387help 


```{r}

```

